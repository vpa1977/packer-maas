#cloud-config
users:
  - name: root
    lock_passwd: false
    hashed_passwd: "$6$canonical.$0zWaW71A9ke9ASsaOcFTdQ2tx1gSmLxMPrsH0rF0Yb.2AEKNPV1lrF94n6YuPJmnUy2K2/JSDtxuiBDey6Lpa/"
    ssh_redirect_user: false
    ssh_import_id:
      - lp:vpa1977
  - name: ubuntu
    lock_passwd: false
    hashed_passwd: "$6$canonical.$0zWaW71A9ke9ASsaOcFTdQ2tx1gSmLxMPrsH0rF0Yb.2AEKNPV1lrF94n6YuPJmnUy2K2/JSDtxuiBDey6Lpa/"
    ssh_redirect_user: false
    ssh_import_id:
      - lp:vpa1977
ssh_pwauth: True
disable_root: false
preserve_hostname: true
apt:
  primary:
    - arches: [default]
      uri:  http://nz.archive.ubuntu.com/ubuntu/
  disable_suites: [backports, security, updates]
package_update: false
package_upgrade: false
update: no
runcmd:
#  - echo 'ubuntu    ALL=(ALL:ALL) NOPASSWD: ALL' >> /etc/sudoers
  - sed -i -e '/^[#]*PermitRootLogin/s/^.*$/PermitRootLogin yes/' /etc/ssh/sshd_config
  - systemctl restart ssh
bootcmd:
  - mkdir /run/packer_backup
  - mkdir /run/packer_backup/etc
  - mkdir /run/packer_backup/etc/apt
  - mkdir /run/packer_backup/etc/ssh
  - cp --preserve /etc/apt/sources.list /run/packer_backup/etc/apt/
  - cp --preserve /etc/ssh/sshd_config /run/packer_backup/etc/ssh/
